<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <!-- æ·»åŠ  viewport meta æ ‡ç­¾ä»¥ç¡®ä¿å“åº”å¼ -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>è“æ ¼å­çº¸é¢ â€” è‡ªåŠ¨è½¬ç§»ï¼ˆæ¯ç»„æœ€å¤šä¸¤è¡Œï¼ŒFactæ ‡ç­¾æ­£çº¢è‰²ï¼ŒTopicè¾“å…¥åå˜é»‘ï¼‰</title>
  <style>
    /* ==================== é€šç”¨æ ·å¼ ==================== */
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }
    /* ç½‘ç«™å¤´éƒ¨ */
    .site-header {
      display: flex;
      align-items: center;
      padding: 10px 20px;
      background: #f5f5f5;
      border-bottom: 1px solid #ddd;
    }
    .site-logo {
      height: 40px;
      width: auto;
      margin-right: 10px;
    }
    .site-title {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      font-weight: bold;
      font-size: 24px;
      color: #333;
    }
    
    /* ==================== æ‰“å°æ ·å¼ ==================== */
    @page {
      size: A4;
      margin: 10mm;
    }
    @media print {
      body * {
        visibility: hidden;
      }
      .page, .page * {
        visibility: visible;
      }
      .page {
        position: absolute;
        left: 0;
        top: 0;
        width: 210mm;
        height: 297mm;
        box-shadow: none;
      }
      .site-header,
      .left-instructions,
      .sidebar-image {
        display: none;
      }
    }
    
    /* ==================== å±å¹•æ ·å¼ ==================== */
    /* å³ä¸Šè§’æ‰“å°æœºå›¾æ ‡ */
    #printButton {
      position: fixed;
      top: 20px;
      right: 20px;
      font-size: 32px;
      cursor: pointer;
      z-index: 1000;
    }
    /* ä¸­æ–‡æ ‡é¢˜åŒºåŸŸï¼šä»…ä¸€å¥ï¼Œç²—ä½“ */
    .chinese-header {
      text-align: center;
      margin: 20px 0;
      font-family: "å¾®è½¯é›…é»‘", sans-serif;
      font-weight: bold;
      font-size: 26px;
      color: black;
    }
    /* çº¸å¤–å·¦ä¾§è¯´æ˜åŒºåŸŸ */
    .left-instructions {
      font-size: 22px;
      font-weight: bold;
      color: black;
      margin-right: 20px;
      max-width: 300px;
      line-height: 1.5;
    }
    /* å¤–å±‚å®¹å™¨ */
    .wrapper {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 20px;
      padding: 20px;
      flex-wrap: wrap;
    }
    /* çº¸ï¼ˆpageï¼‰æ ·å¼ï¼Œå±å¹•ä¸Šçº¦ä¸º 595pxÃ—842pxï¼ˆå¯¹åº” A4 çº¸ï¼‰ */
    .page {
      position: relative;
      width: 595px;
      height: 842px;
      background: white;
      box-shadow: 0 0 5px rgba(0,0,0,0.5);
      box-sizing: border-box;
      counter-reset: linenum;
      margin-bottom: 20px;
    }
    /* å·¦ä¾§çº¢è‰²ç«–çº¿ */
    .red-margin {
      position: absolute;
      top: 0;
      left: 42px;
      height: 100%;
      border-right: 2px solid #FF3034;
      z-index: 2;
    }
    /* é¡¶éƒ¨ç©ºç™½åŒºåŸŸï¼š10px */
    .top-space {
      height: 10px;
    }
    /* åº•éƒ¨ç©ºç™½åŒºåŸŸï¼š15px */
    .bottom-space {
      height: 15px;
    }
    /* Topic åŒºåŸŸ */
    .topic-area {
      text-align: center;
      font-size: 28px;
      color: black;
      margin-bottom: 20px;
      cursor: text;
    }
    .topic-area:empty:before {
      content: "Topic of your essay";
      color: lightgray;
    }
    /* æ¯ä¸€è¡Œé‡‡ç”¨ Flex å¸ƒå±€ï¼šå·¦ä¾§ä¸ºå›ºå®šæ ‡ç­¾ï¼ˆå¦‚æœ‰ï¼‰ï¼Œå³ä¾§ä¸ºå¯ç¼–è¾‘åŒºåŸŸ */
    .line-row {
      position: relative;
      display: flex;
      align-items: center;
      padding: 0 5px 0 50px; /* å·¦ä¾§é¢„ç•™åŒºåŸŸï¼š42pxï¼ˆåŸè¡Œå·+çº¢çº¿ï¼‰+8px */
      border-bottom: 1px solid #3053FF;
      font-size: 16px;
      color: black;
      height: 29px;
      line-height: 29px;
    }
    /* ç»“è®ºè¡Œ */
    .conclusion-row {
      border-top: 1px solid #3053FF;
      border-bottom: 1px solid #3053FF;
      padding-top: 5px;
    }
    /* éšè—åŸæœ‰çš„è¡Œå· */
    .line-row::before {
      content: none;
    }
    /* å›ºå®šæ ‡ç­¾ */
    .label {
      color: black;
      flex: 0 0 auto;
      margin-right: 5px;
    }
    /* è®¾ç½®ç»“è®ºå’Œ Fact æ ‡ç­¾ä¸ºç²—ä½“ */
    .conclusion-row .label,
    .fact {
      font-weight: bold;
    }
    /* Fact æ ‡ç­¾ï¼šæ­£çº¢è‰² */
    .fact {
      color: red;
    }
    /* å¯ç¼–è¾‘æ–‡æœ¬åŒºåŸŸï¼šå›ºå®šä¸ºå•è¡Œæ˜¾ç¤ºï¼Œä¸è‡ªåŠ¨æ¢è¡Œ */
    .editable-text {
      flex: 1 1 auto;
      display: inline-block;
      width: calc(100% - 55px);
      white-space: nowrap;
      overflow: hidden;
    }
    /* è®¾ç½®å¸¦ data-placeholder å±æ€§çš„å ä½ç¬¦æ ·å¼ */
    .editable-text[data-placeholder]:empty:before {
      content: attr(data-placeholder);
      color: lightgray;
    }
    /* é’ˆå¯¹ Reason æ ‡ç­¾è®¾ç½®ç²—ä½“ */
    .reason {
      font-weight: bold;
    }
    /* ç¦æ­¢å›è½¦ */
    [contenteditable]:focus {
      outline: none;
      box-shadow: none;
    }
    /* å³ä¾§å›¾ç‰‡åŒºåŸŸæ ·å¼ */
    .sidebar-image {
      max-width: 400px;
      margin-top: 20px;
    }
    .sidebar-image img {
      width: 100%;
      height: auto;
      display: block;
    }
    
    /* ==================== å“åº”å¼è°ƒæ•´ ==================== */
    @media (max-width: 768px) {
      .wrapper {
        flex-direction: column;
        align-items: center;
      }
      .page {
        width: 90%;
        height: auto;
      }
      .left-instructions,
      .sidebar-image {
        max-width: 90%;
      }
    }
  </style>
</head>
<body>
  <!-- ç½‘ç«™å¤´éƒ¨ï¼šå·¦ä¸Šè§’ logo ä¸æ ‡é¢˜ -->
  <header class="site-header">
    <!-- æ›¿æ¢ä¸‹é¢ logo é“¾æ¥ä¸ºä½ è‡ªå·±çš„ -->
    <img class="site-logo" src="https://github.com/yyun1022/pyramidwriting/blob/a0cfb72f3f64610832cc2c6c2b58ed97c0db7459/pyramid%20(1).png" alt="Site Logo">
    <span class="site-title">Pyramid Writing é‡‘å­—å¡”å†™ä½œ</span>
  </header>
  
  <!-- å³ä¸Šè§’æ‰“å°æœºå›¾æ ‡ -->
  <div id="printButton" onclick="window.print()">ğŸ–¨ï¸</div>
  
  <!-- ä¸­æ–‡æ ‡é¢˜åŒºåŸŸ -->
  <div class="chinese-header">
    è®©æ‚¨çš„å­©å­é©¬ä¸Šå†™é€»è¾‘æ¸…æ¥šçš„è‹±è¯­å¥½æ–‡ç« 
  </div>
  
  <div class="wrapper">
    <!-- çº¸å¤–å·¦ä¾§è¯´æ˜åŒºåŸŸ -->
    <div class="left-instructions">
      1. è¡¨è¾¾ä¸œè¥¿å…ˆè¯´ç»“è®º<br>
      2. æ”¯æ’‘æ—¶è®°å¾—è¯´123<br>
      3. ç„¶åç”¨äº‹å®æ”¯æ’‘ã€‚
    </div>
    
    <!-- A4 çº¸ -->
    <div class="page">
      <div class="red-margin"></div>
      
      <!-- é¡¶éƒ¨ç©ºç™½åŒºåŸŸ -->
      <div class="top-space"></div>
      
      <!-- Topic åŒºåŸŸ -->
      <div class="topic-area" contenteditable="true"></div>
      
      <!-- Block 1: Conclusion -->
      <div class="line-row conclusion-row">
        <span class="label" contenteditable="false">Conclusion:</span>
        <span class="editable-text" contenteditable="true" data-placeholder="ä½ çš„ç»“è®ºåœ¨è¿™é‡Œç®€å•çš„å†™."></span>
      </div>
      <!-- ä¸‹ä¸€è¡Œï¼šç©ºçš„å¯ç¼–è¾‘åŒºåŸŸ -->
      <div class="line-row">
        <span class="editable-text" contenteditable="true"></span>
      </div>
      
      <!-- Block 2: Reason 1 -->
      <div class="line-row">
        <span class="label reason" contenteditable="false">Reason 1</span>
        <span class="editable-text" contenteditable="true" data-placeholder="ä½ çš„ç¬¬ä¸€ä¸ªç†ç”±"></span>
      </div>
      <!-- è¡¥å……è¡Œ -->
      <div class="line-row">
        <span class="editable-text" contenteditable="true"></span>
      </div>
      <!-- Fact a -->
      <div class="line-row">
        <span class="label fact" contenteditable="false">Fact a:</span>
        <span class="editable-text" contenteditable="true" data-placeholder="ç”¨ç¬¬ä¸€ä¸ªäº‹å®æ”¯æ’‘"></span>
      </div>
      <!-- è¡¥å……è¡Œ -->
      <div class="line-row">
        <span class="editable-text" contenteditable="true"></span>
      </div>
      <!-- Fact b -->
      <div class="line-row">
        <span class="label fact" contenteditable="false">Fact b:</span>
        <span class="editable-text" contenteditable="true" data-placeholder="ç”¨ç¬¬äºŒä¸ªäº‹å®æ”¯æ’‘"></span>
      </div>
      <!-- è¡¥å……è¡Œ -->
      <div class="line-row">
        <span class="editable-text" contenteditable="true"></span>
      </div>
      <!-- Fact c -->
      <div class="line-row">
        <span class="label fact" contenteditable="false">Fact c:</span>
        <span class="editable-text" contenteditable="true" data-placeholder="ç”¨ç¬¬ä¸‰ä¸ªäº‹å®æ”¯æ’‘"></span>
      </div>
      <!-- è¡¥å……è¡Œ -->
      <div class="line-row">
        <span class="editable-text" contenteditable="true"></span>
      </div>
      
      <!-- Block 3: Reason 2 -->
      <div class="line-row">
        <span class="label reason" contenteditable="false">Reason 2</span>
        <span class="editable-text" contenteditable="true" data-placeholder="ä½ çš„ç¬¬äºŒä¸ªç†ç”±"></span>
      </div>
      <!-- è¡¥å……è¡Œ -->
      <div class="line-row">
        <span class="editable-text" contenteditable="true"></span>
      </div>
      <!-- Fact a -->
      <div class="line-row">
        <span class="label fact" contenteditable="false">Fact a:</span>
        <span class="editable-text" contenteditable="true" data-placeholder="ç”¨ç¬¬ä¸€ä¸ªäº‹å®æ”¯æ’‘"></span>
      </div>
      <!-- è¡¥å……è¡Œ -->
      <div class="line-row">
        <span class="editable-text" contenteditable="true"></span>
      </div>
      <!-- Fact b -->
      <div class="line-row">
        <span class="label fact" contenteditable="false">Fact b:</span>
        <span class="editable-text" contenteditable="true" data-placeholder="ç”¨ç¬¬äºŒä¸ªäº‹å®æ”¯æ’‘"></span>
      </div>
      <!-- è¡¥å……è¡Œ -->
      <div class="line-row">
        <span class="editable-text" contenteditable="true"></span>
      </div>
      <!-- Fact c -->
      <div class="line-row">
        <span class="label fact" contenteditable="false">Fact c:</span>
        <span class="editable-text" contenteditable="true" data-placeholder="ç”¨ç¬¬ä¸‰ä¸ªäº‹å®æ”¯æ’‘"></span>
      </div>
      <!-- è¡¥å……è¡Œ -->
      <div class="line-row">
        <span class="editable-text" contenteditable="true"></span>
      </div>
      
      <!-- Block 4: Reason 3 -->
      <div class="line-row">
        <span class="label reason" contenteditable="false">Reason 3</span>
        <span class="editable-text" contenteditable="true" data-placeholder="ä½ çš„ç¬¬ä¸‰ä¸ªç†ç”±"></span>
      </div>
      <!-- è¡¥å……è¡Œ -->
      <div class="line-row">
        <span class="editable-text" contenteditable="true"></span>
      </div>
      <!-- Fact a -->
      <div class="line-row">
        <span class="label fact" contenteditable="false">Fact a:</span>
        <span class="editable-text" contenteditable="true" data-placeholder="ç”¨ç¬¬ä¸€ä¸ªäº‹å®æ”¯æ’‘"></span>
      </div>
      <!-- è¡¥å……è¡Œ -->
      <div class="line-row">
        <span class="editable-text" contenteditable="true"></span>
      </div>
      <!-- Fact b -->
      <div class="line-row">
        <span class="label fact" contenteditable="false">Fact b:</span>
        <span class="editable-text" contenteditable="true" data-placeholder="ç”¨ç¬¬äºŒä¸ªäº‹å®æ”¯æ’‘"></span>
      </div>
      <!-- è¡¥å……è¡Œ -->
      <div class="line-row">
        <span class="editable-text" contenteditable="true"></span>
      </div>
      <!-- Fact c -->
      <div class="line-row">
        <span class="label fact" contenteditable="false">Fact c:</span>
        <span class="editable-text" contenteditable="true" data-placeholder="ç”¨ç¬¬ä¸‰ä¸ªäº‹å®æ”¯æ’‘"></span>
      </div>
      <!-- è¡¥å……è¡Œ -->
      <div class="line-row">
        <span class="editable-text" contenteditable="true"></span>
      </div>
      
      <!-- åº•éƒ¨ç©ºç™½åŒºåŸŸ -->
      <div class="bottom-space"></div>
    </div>
    
    <!-- å³ä¾§å›¾ç‰‡åŒºåŸŸï¼ˆæ­¤å¤„ä½¿ç”¨ GitHub ä¸Šå›¾ç‰‡çš„ raw é“¾æ¥ï¼Œè¯·æ›¿æ¢ä¸ºä½ çš„å®é™…é“¾æ¥ï¼‰ -->
    <div class="sidebar-image">
      <img src="https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/åˆ†æ”¯å/è·¯å¾„/å›¾ç‰‡æ–‡ä»¶å.jpg" alt="Your image">
    </div>
  </div>
  
  <script>
    // ç¦æ­¢å›è½¦é”®ï¼Œç¡®ä¿æ¯ä¸ª contenteditable åªå…è®¸å•è¡Œè¾“å…¥
    document.querySelectorAll('[contenteditable]').forEach(el => {
      el.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
        }
      });
    });
    
    // è¾…åŠ©å‡½æ•°ï¼šä½¿ç”¨ canvas æµ‹é‡æ–‡å­—å®½åº¦
    function measureTextWidth(text, font) {
      let canvas = measureTextWidth.canvas || (measureTextWidth.canvas = document.createElement("canvas"));
      let context = canvas.getContext("2d");
      context.font = font;
      return context.measureText(text).width;
    }
    
    /* è‡ªåŠ¨è½¬ç§»æº¢å‡ºé€»è¾‘ï¼š
       æ¯ç»„å‡è®¾ä¸ºä¸¤è¡Œï¼ˆä¾‹å¦‚ Reason 1 ç»„ä¸­çš„ç¬¬ä¸€è¡Œå’Œç¬¬äºŒè¡Œï¼‰ã€‚
       å¯¹äºç¬¬ä¸€è¡Œï¼ˆindex % 2 === 0ï¼‰ï¼š
         - å½“å†…å®¹è¶…å‡ºæ—¶ï¼ŒæŸ¥æ‰¾æœ€åä¸€ä¸ªç©ºæ ¼ï¼Œæå– candidateï¼ˆæœ€åä¸€ä¸ªå•è¯ï¼‰ã€‚
         - è®¡ç®— candidate çš„å®½åº¦ä»¥åŠå½“å‰è¡Œä¸­ candidate ä¹‹å‰çš„æ–‡å­—å®½åº¦ï¼Œå¾—åˆ° availableã€‚
         - å¦‚æœ candidateWidth > availableï¼Œåˆ™è¯´æ˜è¯¥å•è¯æ— æ³•å®Œæ•´æ˜¾ç¤ºï¼Œ
           åˆ™ç›´æ¥èˆå» candidateï¼ˆä»å½“å‰è¡Œåˆ é™¤ä»æœ€åä¸€ä¸ªç©ºæ ¼å¼€å§‹çš„å†…å®¹ï¼‰ã€‚
         - å¦‚æœ candidateWidth <= availableï¼Œå¹¶ä¸”ä¸‹ä¸€è¡Œä¸ºç©ºï¼Œåˆ™å°† candidate æ•´ä½“è½¬ç§»åˆ°ä¸‹ä¸€è¡Œï¼Œ
           å¹¶å°†å…‰æ ‡å®šä½åœ¨ä¸‹ä¸€è¡Œæœ«å°¾ï¼›å¦‚æœä¸‹ä¸€è¡Œå·²æœ‰å†…å®¹ï¼Œåˆ™ç›´æ¥èˆå» candidateã€‚
       å¯¹äºç¬¬äºŒè¡Œï¼ˆindex % 2 === 1ï¼‰ï¼š
         - å½“å†…å®¹è¶…å‡ºæ—¶ï¼ŒæŸ¥æ‰¾æœ€åä¸€ä¸ªç©ºæ ¼ï¼Œå¦‚æœå­˜åœ¨åˆ™åˆ é™¤ä»è¯¥ç©ºæ ¼å¼€å§‹çš„å†…å®¹ï¼Œ
           å¦åˆ™ç›´æ¥æˆªæ–­è¶…å‡ºéƒ¨åˆ†ã€‚
         è¿™æ ·ç¡®ä¿ç¬¬äºŒè¡Œä¸ä¼šåœ¨å¼€å¤´å‡ºç°å¤šä½™å­—ç¬¦ã€‚
    */
    const editableList = Array.from(document.querySelectorAll('.editable-text'));
    editableList.forEach((el, index) => {
      el.addEventListener('input', function() {
        el.style.whiteSpace = 'nowrap';
        void el.offsetWidth; // å¼ºåˆ¶é‡æ’
        if (index % 2 === 0) { // ç¬¬ä¸€è¡Œ
          while (el.scrollWidth > el.clientWidth) {
            let text = el.innerText;
            if (text.length === 0) break;
            let lastSpace = text.lastIndexOf(' ');
            if (lastSpace === -1) {
              el.innerText = "";
              break;
            }
            let candidate = text.slice(lastSpace + 1);
            let computedStyle = window.getComputedStyle(el);
            let font = computedStyle.font;
            let candidateWidth = measureTextWidth(candidate, font);
            let widthBefore = measureTextWidth(text.slice(0, lastSpace), font);
            let available = el.clientWidth - widthBefore;
            if (candidateWidth > available) {
              // candidate ä¸èƒ½å®Œæ•´æ˜¾ç¤ºï¼Œèˆå» candidate
              el.innerText = text.slice(0, lastSpace);
              break;
            } else {
              if (index < editableList.length - 1) {
                let nextEl = editableList[index + 1];
                if (nextEl.innerText.trim() === "") {
                  el.innerText = text.slice(0, lastSpace);
                  nextEl.innerText = candidate;
                  // å°†å…‰æ ‡ç½®äº nextEl æœ«å°¾
                  nextEl.focus();
                  let range = document.createRange();
                  range.selectNodeContents(nextEl);
                  range.collapse(false);
                  let sel = window.getSelection();
                  sel.removeAllRanges();
                  sel.addRange(range);
                  break;
                } else {
                  // ä¸‹ä¸€è¡Œå·²æœ‰å†…å®¹ï¼Œèˆå» candidate
                  el.innerText = text.slice(0, lastSpace);
                  break;
                }
              } else {
                el.innerText = text.slice(0, lastSpace);
                break;
              }
            }
          }
        } else { // ç¬¬äºŒè¡Œ
          while (el.scrollWidth > el.clientWidth) {
            let text = el.innerText;
            if (text.length === 0) break;
            let lastSpace = text.lastIndexOf(' ');
            if (lastSpace !== -1) {
              el.innerText = text.slice(0, lastSpace);
            } else {
              el.innerText = "";
            }
            break;
          }
        }
      });
    });
  </script>
</body>
</html>
